!function(){"use strict";class e{constructor(e,t,s,i,r,n){this._id=e._id,this._name=e.name,this._link=e.link,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteClick=i,this._userId=r,this._cardOwnerId=e.owner._id,this._handleLikeClick=n,this._likeArr=e.likes}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._likeBtn=this._card.querySelector("#card_like-button"),this._deleteBtn=this._card.querySelector(".card__delete-btn"),this._image=this._card.querySelector(".card__image"),this._likeBtn.addEventListener("click",(()=>{this._toggleLikeBtn(),this._handleLikeClick(this._id)})),this._deleteBtn.addEventListener("click",(()=>this._handleDeleteClick(this._id))),this._image.addEventListener("click",(()=>this._openImage()))}_openImage(){this._handleImageClick(this._link,this._name)}_toggleLikeBtn(){this._likeBtn.classList.toggle("card__like-button_enabled")}isLiked(){return this._likeArr.some((e=>{let{_id:t}=e;return t===this._userId}))}_renderLikesCounter(){this._likeCounter=this._card.querySelector(".card__like_counter"),this._likeCounter.textContent=this._likeArr.length}removeCard(){this._card.remove(),this._card=null}getView(){return this._card=this._getTemplate(),this._setEventListeners(),this._image.src=this._link,this._image.alt=this._name,this._card.querySelector(".card__title").textContent=this._name,this._userId!==this._cardOwnerId&&this._deleteBtn.remove(),this.isLiked()&&this._toggleLikeBtn(),this._renderLikesCounter(),this._card}}const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button-disabled",inputErrorClass:".modal__input-type-error",errorClass:"modal__error_visible",cardSectionClass:".cards__list",cardTeplate:".card__teplate"};class s{constructor(e,t){let{data:s,renderer:i}=e;this._renderedItems=s,this._renderer=i,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderItems(){this._renderedItems.forEach((e=>{this._renderer(e)}))}}class i{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._closeByEsc)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._closeByEsc)}_closeByEsc=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{e.target.classList.contains("modal")&&this.close(),e.target.classList.contains("modal__close-button")&&this.close()}))}}class r extends i{constructor(e,s){super({popupSelector:e}),this._popupFormEl=this._popupElement.querySelector(t.formSelector),this._inputEls=this._popupFormEl.querySelectorAll(t.inputSelector),this._handleSubmit=s}setInputValues(e){this._inputEls.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._popupFormEl.reset()}_getInputValues(){const e={};return this._inputEls.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupFormEl.addEventListener("submit",(()=>{this._handleSubmit(this._getInputValues())}))}}class n{constructor(e){let{title:t,subtitle:s}=e;this._nameEl=document.querySelector(t),this._jobEl=document.querySelector(s)}getUserInfo(){return{name:this._nameEl.textContent,about:this._jobEl.textContent}}setUserInfo(e){this._nameEl.textContent=e.name,this._jobEl.textContent=e.about}}const o=document.querySelector("#profile__add-button"),a=document.querySelector("#profile__edit-btn"),l=document.querySelector("#profile__avatar-btn");let h,_,d;function c(t){const s=function(t){return new e(t,"#card__template",u,m,d,p).getView()}(t);h.addItem(s)}function u(e,t){S.open(e,t)}function m(e){k.open(),k.setSubmitAction((()=>{E.deleteCard(e).then((()=>{this.removeCard(),k.close()}))}))}function p(e){this.isLiked()?E.removeLike(e):E.addLike(e)}const E=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}updateUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}addNewCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateProfilePicture(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"cd8b3986-f3d6-4da9-8f48-96bc48ae4bb7","Content-Type":"application/json"}});E.getUserInfo().then((e=>{d=e._id,_=new n({title:".profile__title",subtitle:".profile__subtitle"}),_.setUserInfo(e)})),E.getInitialCards().then((e=>{h=new s({data:e,renderer:e=>{c(e)}},t.cardSectionClass),h.renderItems()}));const b=new r("#profile__edit-modal",(e=>{_.setUserInfo(e),E.updateUserInfo(e),b.close()})),v=new r("#profile__avatar_modal"),k=new class extends i{constructor(e){super({popupSelector:e}),this._submitBtn=this._popupElement.querySelector(".modal__save-button")}setSubmitAction(e){this._handleDelete=e}setEventListeners(){super.setEventListeners(),this._submitBtn.addEventListener("mousedown",(()=>{this._handleDelete()}))}}("#card__delete-modal"),S=new class extends i{constructor(e){super({popupSelector:e}),this._image=this._popupElement.querySelector(".modal__image"),this._caption=this._popupElement.querySelector(".modal__image-caption")}open(e,t){super.open(),this._image.src=e,this._image.alt=t,this._caption.textContent=t}}("#card__image-modal"),f=new r("#profile__add-modal",(e=>{E.addNewCard(e).then((e=>c(e))),f.close()})),L={};(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{const s=new class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._buttonEl=this._formElement.querySelector(this._submitButtonSelector),this._inputEls=[...this._formElement.querySelectorAll(this._inputSelector)]}_setEventListeners(){this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._checkValidity(e),this._toggleSubmitBtn(e)})),this._disableSubmitBtn(),this._formElement.addEventListener("reset",(()=>{setTimeout((()=>{this._toggleSubmitBtn(e)}),0)}))}))}_checkValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_toggleSubmitBtn(){this._hasInvalidInput()?this._disableSubmitBtn():this._enableSubmitBtn()}_hasInvalidInput(){return!this._inputEls.every((e=>e.validity.valid))}_disableSubmitBtn(){this._buttonEl.classList.add(this._inactiveButtonClass),this._buttonEl.disabled=!0}_enableSubmitBtn(){this._buttonEl.classList.remove(this._inactiveButtonClass),this._buttonEl.disabled=!1}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}(e,t),i=t.getAttribute("name");L[i]=s,s.enableValidation()}))})(t),S.setEventListeners(),f.setEventListeners(),b.setEventListeners(),k.setEventListeners(),o.addEventListener("click",(()=>f.open())),a.addEventListener("click",(()=>{b.open(),b.setInputValues(_.getUserInfo())})),l.addEventListener("click",(()=>v.open()))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQWUsTUFBTUEsRUFDbkJDLFlBQVlDLEVBQU1DLEVBQWNDLEVBQWtCQyxFQUFtQkMsRUFBUUMsR0FDM0VDLEtBQUtDLElBQU1QLEVBQUtPLElBQ2hCRCxLQUFLRSxNQUFRUixFQUFLUyxLQUNsQkgsS0FBS0ksTUFBUVYsRUFBS1csS0FDbEJMLEtBQUtNLGNBQWdCWCxFQUNyQkssS0FBS08sa0JBQW9CWCxFQUN6QkksS0FBS1EsbUJBQXFCWCxFQUMxQkcsS0FBS1MsUUFBVVgsRUFDZkUsS0FBS1UsYUFBZWhCLEVBQUtpQixNQUFNVixJQUMvQkQsS0FBS1ksaUJBQW1CYixFQUN4QkMsS0FBS2EsU0FBV25CLEVBQUtvQixLQUV2QixDQUVBQyxlQUtFLE9BSmVDLFNBQ1pDLGNBQWNqQixLQUFLTSxlQUNuQlksUUFBUUQsY0FBYyxTQUN0QkUsV0FBVSxFQUVmLENBRUFDLHFCQUNFcEIsS0FBS3FCLFNBQVdyQixLQUFLc0IsTUFBTUwsY0FBYyxxQkFDekNqQixLQUFLdUIsV0FBYXZCLEtBQUtzQixNQUFNTCxjQUFjLHFCQUMzQ2pCLEtBQUt3QixPQUFTeEIsS0FBS3NCLE1BQU1MLGNBQWMsZ0JBQ3ZDakIsS0FBS3FCLFNBQVNJLGlCQUFpQixTQUFTLEtBQU96QixLQUFLMEIsaUJBQWtCMUIsS0FBS1ksaUJBQWlCWixLQUFLQyxJQUFJLElBQ3JHRCxLQUFLdUIsV0FBV0UsaUJBQWlCLFNBQVMsSUFBTXpCLEtBQUtRLG1CQUFtQlIsS0FBS0MsT0FDN0VELEtBQUt3QixPQUFPQyxpQkFBaUIsU0FBUyxJQUFNekIsS0FBSzJCLGNBQ25ELENBRUFBLGFBQ0UzQixLQUFLTyxrQkFBa0JQLEtBQUtJLE1BQU9KLEtBQUtFLE1BQzFDLENBRUF3QixpQkFDRTFCLEtBQUtxQixTQUFTTyxVQUFVQyxPQUFPLDRCQUNqQyxDQUVBQyxVQUNFLE9BQU85QixLQUFLYSxTQUFTa0IsTUFBS0MsSUFBVyxJQUFWLElBQUMvQixHQUFJK0IsRUFDOUIsT0FBTy9CLElBQVFELEtBQUtTLE9BQU8sR0FFL0IsQ0FFQXdCLHNCQUNFakMsS0FBS2tDLGFBQWVsQyxLQUFLc0IsTUFBTUwsY0FBYyx1QkFDN0NqQixLQUFLa0MsYUFBYUMsWUFBY25DLEtBQUthLFNBQVN1QixNQUVoRCxDQUVBQyxhQUNFckMsS0FBS3NCLE1BQU1nQixTQUNYdEMsS0FBS3NCLE1BQVEsSUFDZixDQUVBaUIsVUFlRSxPQWRBdkMsS0FBS3NCLE1BQVF0QixLQUFLZSxlQUNsQmYsS0FBS29CLHFCQUNMcEIsS0FBS3dCLE9BQU9nQixJQUFNeEMsS0FBS0ksTUFDdkJKLEtBQUt3QixPQUFPaUIsSUFBTXpDLEtBQUtFLE1BQ3ZCRixLQUFLc0IsTUFBTUwsY0FBYyxnQkFBZ0JrQixZQUFjbkMsS0FBS0UsTUFFekRGLEtBQUtTLFVBQVlULEtBQUtVLGNBQ3ZCVixLQUFLdUIsV0FBV2UsU0FFZnRDLEtBQUs4QixXQUNOOUIsS0FBSzBCLGlCQUVQMUIsS0FBS2lDLHNCQUVFakMsS0FBS3NCLEtBQ2QsRUN2RUYsTUFBTW9CLEVBQVMsQ0FDYkMsYUFBYyxlQUNkQyxjQUFlLGdCQUNmQyxxQkFBc0Isc0JBQ3RCQyxvQkFBcUIsOEJBQ3JCQyxnQkFBaUIsMkJBQ2pCQyxXQUFZLHVCQUNaQyxpQkFBa0IsZUFDbEJDLFlBQWEsa0JDVkEsTUFBTUMsRUFDbkIxRCxZQUFXdUMsRUFBcUJvQixHQUFVLElBQTlCLEtBQUUxRCxFQUFJLFNBQUUyRCxHQUFVckIsRUFDNUJoQyxLQUFLc0QsZUFBaUI1RCxFQUN0Qk0sS0FBS3VELFVBQVlGLEVBQ2pCckQsS0FBS3dELFdBQWF4QyxTQUFTQyxjQUFjbUMsRUFDM0MsQ0FFQUssUUFBUUMsR0FDTjFELEtBQUt3RCxXQUFXRyxRQUFRRCxFQUMxQixDQUVBRSxjQUNFNUQsS0FBS3NELGVBQWVPLFNBQVNDLElBQzNCOUQsS0FBS3VELFVBQVVPLEVBQUssR0FFeEIsRUNmYSxNQUFNQyxFQUNuQnRFLFlBQVd1QyxHQUFvQixJQUFuQixjQUFFZ0MsR0FBZWhDLEVBQzNCaEMsS0FBS2lFLGNBQWdCakQsU0FBU0MsY0FBYytDLEVBQzlDLENBQ0FFLE9BRUVsRSxLQUFLaUUsY0FBY3JDLFVBQVV1QyxJQUFJLGdCQUNqQ25ELFNBQVNTLGlCQUFpQixVQUFXekIsS0FBS29FLFlBQzVDLENBQ0FDLFFBRUVyRSxLQUFLaUUsY0FBY3JDLFVBQVVVLE9BQU8sZ0JBQ3BDdEIsU0FBU3NELG9CQUFvQixVQUFXdEUsS0FBS29FLFlBQy9DLENBQ0FBLFlBQWVHLElBQ0csV0FBWkEsRUFBSUMsS0FDTnhFLEtBQUtxRSxPQUNQLEVBR0ZJLG9CQUNFekUsS0FBS2lFLGNBQWN4QyxpQkFBaUIsYUFBYzhDLElBQzVDQSxFQUFJRyxPQUFPOUMsVUFBVStDLFNBQVMsVUFDaEMzRSxLQUFLcUUsUUFFSEUsRUFBSUcsT0FBTzlDLFVBQVUrQyxTQUFTLHdCQUNoQzNFLEtBQUtxRSxPQUNQLEdBRUosRUMxQmEsTUFBTU8sVUFBc0JiLEVBQ3pDdEUsWUFBWXVFLEVBQWVhLEdBQ3pCQyxNQUFNLENBQUVkLGtCQUNSaEUsS0FBSytFLGFBQWUvRSxLQUFLaUUsY0FBY2hELGNBQWN5QixFQUFPQyxjQUM1RDNDLEtBQUtnRixVQUFZaEYsS0FBSytFLGFBQWFFLGlCQUFpQnZDLEVBQU9FLGVBQzNENUMsS0FBS2tGLGNBQWdCTCxDQUN2QixDQUNBTSxlQUFlekYsR0FDYk0sS0FBS2dGLFVBQVVuQixTQUFTdUIsSUFFdEJBLEVBQU1DLE1BQVEzRixFQUFLMEYsRUFBTWpGLEtBQUssR0FFbEMsQ0FFQWtFLFFBQ0VTLE1BQU1ULFFBQ05yRSxLQUFLK0UsYUFBYU8sT0FDcEIsQ0FFQUMsa0JBQ0UsTUFBTUMsRUFBYyxDQUFDLEVBT3JCLE9BSkF4RixLQUFLZ0YsVUFBVW5CLFNBQVN1QixJQUV0QkksRUFBWUosRUFBTWpGLE1BQVFpRixFQUFNQyxLQUFLLElBRWhDRyxDQUNULENBRUFmLG9CQUNFSyxNQUFNTCxvQkFDTnpFLEtBQUsrRSxhQUFhdEQsaUJBQWlCLFVBQVUsS0FDM0N6QixLQUFLa0YsY0FBY2xGLEtBQUt1RixrQkFBa0IsR0FFOUMsRUN0Q2EsTUFBTUUsRUFDbkJoRyxZQUFXdUMsR0FBc0IsSUFBckIsTUFBRTBELEVBQUssU0FBRUMsR0FBVTNELEVBQzdCaEMsS0FBSzRGLFFBQVU1RSxTQUFTQyxjQUFjeUUsR0FDdEMxRixLQUFLNkYsT0FBUzdFLFNBQVNDLGNBQWMwRSxFQUN2QyxDQUVBRyxjQUNFLE1BQU8sQ0FDTDNGLEtBQU1ILEtBQUs0RixRQUFRekQsWUFDbkI0RCxNQUFPL0YsS0FBSzZGLE9BQU8xRCxZQUV2QixDQUNBNkQsWUFBWVgsR0FHVnJGLEtBQUs0RixRQUFRekQsWUFBY2tELEVBQU1sRixLQUNqQ0gsS0FBSzZGLE9BQU8xRCxZQUFja0QsRUFBTVUsS0FDbEMsRUNMRixNQUFNRSxFQUFnQmpGLFNBQVNDLGNBQWMsd0JBQ3ZDaUYsRUFBaUJsRixTQUFTQyxjQUFjLHNCQUN4Q2tGLEVBQW1CbkYsU0FBU0MsY0FBYyx3QkFFaEQsSUFBSW1GLEVBRUFDLEVBRUF2RyxFQWNKLFNBQVN3RyxFQUFXeEMsR0FDbEIsTUFBTXlDLEVBYlIsU0FBb0J6QyxHQVNsQixPQVJvQixJQUFJdEUsRUFDdEJzRSxFQUNBLGtCQUNBbEUsRUFDQUMsRUFDQUMsRUFDQUMsR0FDQXdDLFNBRUosQ0FHZWlFLENBQVcxQyxHQUN4QnNDLEVBQVkzQyxRQUFROEMsRUFDdEIsQ0FFQSxTQUFTM0csRUFBaUJPLEVBQU1FLEdBQzlCb0csRUFBV3ZDLEtBQUsvRCxFQUFNRSxFQUN4QixDQUVBLFNBQVNSLEVBQWtCNkcsR0FDekJDLEVBQVl6QyxPQUNaeUMsRUFBWUMsaUJBQWlCLEtBQzNCQyxFQUFJQyxXQUFXSixHQUFRSyxNQUFNLEtBQzNCL0csS0FBS3FDLGFBQ0xzRSxFQUFZdEMsT0FBTyxHQUNuQixHQUVOLENBRUEsU0FBU3RFLEVBQWdCMkcsR0FDcEIxRyxLQUFLOEIsVUFDTitFLEVBQUlHLFdBQVdOLEdBR2ZHLEVBQUlJLFFBQVFQLEVBR2hCLENBT0EsTUFBTUcsRUFBTSxJQ3BFRyxNQUNYcEgsWUFBWXlILEdBQ1JsSCxLQUFLbUgsU0FBV0QsRUFBUUUsUUFDeEJwSCxLQUFLcUgsU0FBV0gsRUFBUUksT0FFNUIsQ0FFQUMsZUFBZUMsR0FDWCxPQUFJQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUVOQyxRQUFRQyxPQUFRLFVBQVNKLEVBQUlLLFNBQ3hDLENBR0FDLGtCQUNFLE9BQU9DLE1BQU8sR0FBRS9ILEtBQUttSCxpQkFBaUIsQ0FDcENHLFFBQVN0SCxLQUFLcUgsV0FFZk4sS0FBSy9HLEtBQUt1SCxlQUNiLENBRUF6QixjQUNFLE9BQU9pQyxNQUFPLEdBQUUvSCxLQUFLbUgsb0JBQW9CLENBQ3ZDRyxRQUFTdEgsS0FBS3FILFdBRWZOLEtBQUsvRyxLQUFLdUgsZUFDYixDQUdBUyxlQUFlNUMsR0FDYixPQUFPMkMsTUFBTyxHQUFFL0gsS0FBS21ILG9CQUFxQixDQUN4Q2MsT0FBUSxRQUNSWCxRQUFTdEgsS0FBS3FILFNBQ2RhLEtBQU1DLEtBQUtDLFVBQVUsQ0FDbkJqSSxLQUFNaUYsRUFBTWpGLEtBQ1o0RixNQUFPWCxFQUFNVyxVQUdoQmdCLEtBQUsvRyxLQUFLdUgsZUFDYixDQUVBYyxXQUFXakQsR0FDVCxPQUFPMkMsTUFBTyxHQUFFL0gsS0FBS21ILGlCQUFrQixDQUNyQ2MsT0FBUSxPQUNSWCxRQUFTdEgsS0FBS3FILFNBQ2RhLEtBQU1DLEtBQUtDLFVBQVUsQ0FDbkJqSSxLQUFNaUYsRUFBTWpGLEtBQ1pFLEtBQU0rRSxFQUFNL0UsU0FHZjBHLEtBQUsvRyxLQUFLdUgsZUFDYixDQUVBVCxXQUFXSixHQUNULE9BQU9xQixNQUFPLEdBQUUvSCxLQUFLbUgsa0JBQWtCVCxJQUFTLENBQzlDdUIsT0FBUSxTQUNSWCxRQUFTdEgsS0FBS3FILFdBRWZOLEtBQUsvRyxLQUFLdUgsZUFDYixDQUNBTixRQUFRUCxHQUNOLE9BQU9xQixNQUFPLEdBQUUvSCxLQUFLbUgsd0JBQXdCVCxJQUFTLENBQ3BEdUIsT0FBUSxNQUNSWCxRQUFTdEgsS0FBS3FILFdBRWZOLEtBQUsvRyxLQUFLdUgsZUFDYixDQUNBUCxXQUFXTixHQUNULE9BQU9xQixNQUFPLEdBQUUvSCxLQUFLbUgsd0JBQXdCVCxJQUFTLENBQ25EdUIsT0FBUSxTQUNUWCxRQUFTdEgsS0FBS3FILFdBRWZOLEtBQUsvRyxLQUFLdUgsZUFDYixDQUNBZSxxQkFBcUJDLEdBQ25CLE9BQU9SLE1BQU8sR0FBRS9ILEtBQUttSCwyQkFBMkIsQ0FDOUNjLE9BQVEsUUFDUlgsUUFBU3RILEtBQUtxSCxTQUNkYSxLQUFNQyxLQUFLQyxVQUFVRyxJQUV6QixHRGJnQixDQUNsQm5CLFFBQVMsOENBQ1RFLFFBQVMsQ0FDUGtCLGNBQWUsdUNBQ2YsZUFBZ0Isc0JBSXBCM0IsRUFBSWYsY0FBY2lCLE1BQU1TLElBRXRCMUgsRUFBUzBILEVBQUl2SCxJQUVib0csRUFBVyxJQUFJWixFQUFTLENBQ3RCQyxNQUFPLGtCQUNQQyxTQUFVLHVCQUdaVSxFQUFTTCxZQUFZd0IsRUFBSSxJQUkzQlgsRUFBSWlCLGtCQUFrQmYsTUFBTVMsSUFFMUJwQixFQUFjLElBQUlqRCxFQUNoQixDQUVFekQsS0FBTThILEVBQ05uRSxTQUFXUyxJQUNUd0MsRUFBV3hDLEVBQUssR0FHcEJwQixFQUFPTyxrQkFFVG1ELEVBQVl4QyxhQUFhLElBSTNCLE1BQU02RSxFQUFnQixJQUFJN0QsRUFDeEIsd0JBQ0NZLElBQ0NhLEVBQVNMLFlBQVlSLEdBRXJCcUIsRUFBSW1CLGVBQWV4QyxHQUNuQmlELEVBQWNwRSxPQUFPLElBSW5CcUUsRUFBa0IsSUFBSTlELEVBQWMsMEJBRXBDK0IsRUFBYyxJRXBITCxjQUEwQjVDLEVBQ3JDdEUsWUFBWXVFLEdBQ1JjLE1BQU0sQ0FBQ2Qsa0JBQ1BoRSxLQUFLMkksV0FBYTNJLEtBQUtpRSxjQUFjaEQsY0FBYyxzQkFFdkQsQ0FFQTJGLGdCQUFnQmdDLEdBQ1o1SSxLQUFLNkksY0FBZ0JELENBQ3pCLENBRUFuRSxvQkFDSUssTUFBTUwsb0JBQ056RSxLQUFLMkksV0FBV2xILGlCQUFpQixhQUFhLEtBQzFDekIsS0FBSzZJLGVBQWUsR0FFNUIsR0ZvR2dDLHVCQUU5QnBDLEVBQWEsSUdySEosY0FBNkIxQyxFQUMxQ3RFLFlBQVl1RSxHQUNWYyxNQUFNLENBQUVkLGtCQUNSaEUsS0FBS3dCLE9BQVN4QixLQUFLaUUsY0FBY2hELGNBQWMsaUJBQy9DakIsS0FBSzhJLFNBQVc5SSxLQUFLaUUsY0FBY2hELGNBQWMsd0JBQ25ELENBQ0FpRCxLQUFLL0QsRUFBTUUsR0FDVHlFLE1BQU1aLE9BQ05sRSxLQUFLd0IsT0FBT2dCLElBQU1yQyxFQUNsQkgsS0FBS3dCLE9BQU9pQixJQUFNcEMsRUFDbEJMLEtBQUs4SSxTQUFTM0csWUFBYzlCLENBQzlCLEdIMEdvQyxzQkFFaEMwSSxFQUFlLElBQUluRSxFQUFjLHVCQUF3QlksSUFDN0RxQixFQUFJd0IsV0FBVzdDLEdBQWF1QixNQUFNckgsR0FBUzRHLEVBQVc1RyxLQUN0RHFKLEVBQWExRSxPQUFPLElBUWhCMkUsRUFBaUIsQ0FBQyxFQUdFdEcsS0FDUHVHLE1BQU1DLEtBQUtsSSxTQUFTaUUsaUJBQWlCdkMsRUFBT0MsZUFDcERrQixTQUFTc0YsSUFDaEIsTUFBTUMsRUFBWSxJSXpJdEIsTUFDRTNKLFlBQVlpRCxFQUFReUcsR0FDbEJuSixLQUFLcUosZUFBaUIzRyxFQUFPRSxjQUM3QjVDLEtBQUtzSixzQkFBd0I1RyxFQUFPRyxxQkFDcEM3QyxLQUFLdUoscUJBQXVCN0csRUFBT0ksb0JBQ25DOUMsS0FBS3dKLGlCQUFtQjlHLEVBQU9LLGdCQUMvQi9DLEtBQUt5SixZQUFjL0csRUFBT00sV0FDMUJoRCxLQUFLMEosYUFBZVAsRUFDcEJuSixLQUFLMkosVUFBWTNKLEtBQUswSixhQUFhekksY0FDakNqQixLQUFLc0osdUJBRVB0SixLQUFLZ0YsVUFBWSxJQUNaaEYsS0FBSzBKLGFBQWF6RSxpQkFBaUJqRixLQUFLcUosZ0JBRS9DLENBRUFqSSxxQkFDRXBCLEtBQUtnRixVQUFVbkIsU0FBUytGLElBQ3RCQSxFQUFRbkksaUJBQWlCLFNBQVMsS0FDaEN6QixLQUFLNkosZUFBZUQsR0FDcEI1SixLQUFLOEosaUJBQWlCRixFQUFRLElBRWhDNUosS0FBSytKLG9CQUVML0osS0FBSzBKLGFBQWFqSSxpQkFBaUIsU0FBUyxLQUUxQ3VJLFlBQVcsS0FDVGhLLEtBQUs4SixpQkFBaUJGLEVBQVEsR0FDN0IsRUFBRSxHQUNMLEdBRU4sQ0FFQUMsZUFBZUQsR0FFUkEsRUFBUUssU0FBU0MsTUFHcEJsSyxLQUFLbUssZ0JBQWdCUCxHQUZyQjVKLEtBQUtvSyxnQkFBZ0JSLEVBSXpCLENBRUFRLGdCQUFnQlIsR0FDZCxNQUFNUyxFQUFlckssS0FBSzBKLGFBQWF6SSxjQUNwQyxJQUFHMkksRUFBUVUsWUFFZFYsRUFBUWhJLFVBQVV1QyxJQUFJbkUsS0FBS3dKLGtCQUMzQmEsRUFBYWxJLFlBQWN5SCxFQUFRVyxrQkFDbkNGLEVBQWF6SSxVQUFVdUMsSUFBSW5FLEtBQUt5SixZQUNsQyxDQUVBVSxnQkFBZ0JQLEdBQ2QsTUFBTVMsRUFBZXJLLEtBQUswSixhQUFhekksY0FDcEMsSUFBRzJJLEVBQVFVLFlBRWRWLEVBQVFoSSxVQUFVVSxPQUFPdEMsS0FBS3dKLGtCQUM5QmEsRUFBYWxJLFlBQWMsR0FDM0JrSSxFQUFhekksVUFBVVUsT0FBT3RDLEtBQUt5SixZQUNyQyxDQUVBSyxtQkFDTTlKLEtBQUt3SyxtQkFDUHhLLEtBQUsrSixvQkFFTC9KLEtBQUt5SyxrQkFFVCxDQUVBRCxtQkFDRSxPQUFReEssS0FBS2dGLFVBQVUwRixPQUFPZCxHQUFZQSxFQUFRSyxTQUFTQyxPQUM3RCxDQUVBSCxvQkFDRS9KLEtBQUsySixVQUFVL0gsVUFBVXVDLElBQUluRSxLQUFLdUosc0JBQ2xDdkosS0FBSzJKLFVBQVVnQixVQUFXLENBQzVCLENBRUFGLG1CQUNFekssS0FBSzJKLFVBQVUvSCxVQUFVVSxPQUFPdEMsS0FBS3VKLHNCQUNyQ3ZKLEtBQUsySixVQUFVZ0IsVUFBVyxDQUM1QixDQUVBQyxtQkFDRTVLLEtBQUswSixhQUFhakksaUJBQWlCLFVBQVc4QyxJQUM1Q0EsRUFBSXNHLGdCQUFnQixJQUV0QjdLLEtBQUtvQixvQkFDUCxHSmtEc0NzQixFQUFReUcsR0FFdEMyQixFQUFXM0IsRUFBWTRCLGFBQWEsUUFHMUMvQixFQUFlOEIsR0FBWTFCLEVBQzNCQSxFQUFVd0Isa0JBQWtCLEdBQzVCLEVBR0pBLENBQWlCbEksR0FFakIrRCxFQUFXaEMsb0JBQ1hzRSxFQUFhdEUsb0JBQ2JnRSxFQUFjaEUsb0JBQ2RrQyxFQUFZbEMsb0JBQ1p3QixFQUFjeEUsaUJBQWlCLFNBQVMsSUFBTXNILEVBQWE3RSxTQUMzRGdDLEVBQWV6RSxpQkFBaUIsU0FBUyxLQUN2Q2dILEVBQWN2RSxPQUNkdUUsRUFBY3RELGVBQWVrQixFQUFTUCxjQUFjLElBRXRESyxFQUFpQjFFLGlCQUFpQixTQUFTLElBQU1pSCxFQUFnQnhFLFEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cERlbGV0ZS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gIGNvbnN0cnVjdG9yKGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlSW1hZ2VDbGljaywgaGFuZGxlRGVsZXRlQ2xpY2ssIHVzZXJJZCwgaGFuZGxlTGlrZUNsaWNrKSB7XHJcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xyXG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XHJcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrID0gaGFuZGxlRGVsZXRlQ2xpY2s7XHJcbiAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XHJcbiAgICB0aGlzLl9jYXJkT3duZXJJZCA9IGRhdGEub3duZXIuX2lkO1xyXG4gICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrID0gaGFuZGxlTGlrZUNsaWNrO1xyXG4gICAgdGhpcy5fbGlrZUFyciA9IGRhdGEubGlrZXM7XHJcbiAgICBcclxuICB9XHJcblxyXG4gIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgIGNvbnN0IGNhcmRFbCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICByZXR1cm4gY2FyZEVsO1xyXG4gIH1cclxuXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fbGlrZUJ0biA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIiNjYXJkX2xpa2UtYnV0dG9uXCIpO1xyXG4gICAgdGhpcy5fZGVsZXRlQnRuID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XHJcbiAgICB0aGlzLl9pbWFnZSA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIHRoaXMuX2xpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHt0aGlzLl90b2dnbGVMaWtlQnRuKCksIHRoaXMuX2hhbmRsZUxpa2VDbGljayh0aGlzLl9pZCk7fSk7XHJcbiAgICB0aGlzLl9kZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrKHRoaXMuX2lkKSk7XHJcbiAgICB0aGlzLl9pbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5fb3BlbkltYWdlKCkpO1xyXG4gIH1cclxuXHJcbiAgX29wZW5JbWFnZSgpIHtcclxuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sodGhpcy5fbGluaywgdGhpcy5fbmFtZSk7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlTGlrZUJ0bigpIHtcclxuICAgIHRoaXMuX2xpa2VCdG4uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2VuYWJsZWRcIik7XHJcbiAgfVxyXG5cclxuICBpc0xpa2VkKCl7XHJcbiAgICByZXR1cm4gdGhpcy5fbGlrZUFyci5zb21lKCh7X2lkfSkgPT4geyAgICAgIFxyXG4gICAgICByZXR1cm4gX2lkID09PSB0aGlzLl91c2VySWQgICAgICAgXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgX3JlbmRlckxpa2VzQ291bnRlcigpe1xyXG4gICAgdGhpcy5fbGlrZUNvdW50ZXIgPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZV9jb3VudGVyXCIpICAgIFxyXG4gICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlQXJyLmxlbmd0aFxyXG5cclxuICB9XHJcblxyXG4gIHJlbW92ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9jYXJkLnJlbW92ZSgpO1xyXG4gICAgdGhpcy5fY2FyZCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBnZXRWaWV3KCkge1xyXG4gICAgdGhpcy5fY2FyZCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5faW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2ltYWdlLmFsdCA9IHRoaXMuX25hbWU7XHJcbiAgICB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xyXG4gICAgLy9jaGVjayBpZiB1c2VyIGFuZCBvd25lciBJRCBtYXRjaGVzXHJcbiAgICBpZih0aGlzLl91c2VySWQgIT09IHRoaXMuX2NhcmRPd25lcklkKXtcclxuICAgICAgdGhpcy5fZGVsZXRlQnRuLnJlbW92ZSgpXHJcbiAgICB9IFxyXG4gICAgaWYodGhpcy5pc0xpa2VkKCkpe1xyXG4gICAgICB0aGlzLl90b2dnbGVMaWtlQnRuKClcclxuICAgIH1cclxuICAgIHRoaXMuX3JlbmRlckxpa2VzQ291bnRlcigpXHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmQ7XHJcbiAgfVxyXG59XHJcbiIsIi8vc2VsZWN0b3JzIGZvciB2YWxpZGF0aW9uXHJcblxyXG5jb25zdCBjb25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc2F2ZS1idXR0b25cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zYXZlLWJ1dHRvbi1kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCIubW9kYWxfX2lucHV0LXR5cGUtZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXHJcbiAgY2FyZFNlY3Rpb25DbGFzczogXCIuY2FyZHNfX2xpc3RcIixcclxuICBjYXJkVGVwbGF0ZTogXCIuY2FyZF9fdGVwbGF0ZVwiLFxyXG59O1xyXG5cclxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCIsXHJcbiAgfSxcclxuXTtcclxuXHJcbmV4cG9ydCB7IGNvbmZpZywgaW5pdGlhbENhcmRzIH07XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgZGF0YSwgcmVuZGVyZXIgfSwgY2FyZExpc3QpIHtcclxuICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMgPSBkYXRhO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY2FyZExpc3QpO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5fcmVuZGVyZWRJdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICB9XHJcbiAgb3BlbigpIHtcclxuICAgIC8vb3BlbiBwb3B1cFxyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9jbG9zZUJ5RXNjKTtcclxuICB9XHJcbiAgY2xvc2UoKSB7XHJcbiAgICAvL2Nsb3NlIHBvcHVwXHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2Nsb3NlQnlFc2MpO1xyXG4gIH1cclxuICBfY2xvc2VCeUVzYyA9IChldnQpID0+IHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcclxuICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlLWJ1dHRvblwiKSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cFwiO1xyXG5pbXBvcnQgeyBjb25maWcgfSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZVN1Ym1pdCkge1xyXG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pOyAgICBcclxuICAgIHRoaXMuX3BvcHVwRm9ybUVsID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLmZvcm1TZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9pbnB1dEVscyA9IHRoaXMuX3BvcHVwRm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0OyAgICBcclxuICB9XHJcbiAgc2V0SW5wdXRWYWx1ZXMoZGF0YSkge1xyXG4gICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgLy8gaGVyZSB5b3UgaW5zZXJ0IHRoZSBgdmFsdWVgIGJ5IHRoZSBgbmFtZWAgb2YgdGhlIGlucHV0XHJcbiAgICAgIGlucHV0LnZhbHVlID0gZGF0YVtpbnB1dC5uYW1lXTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtRWwucmVzZXQoKTtcclxuICB9ICBcclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgIC8vZ2V0IGFsbCBpbnB1dHMgICAgXHJcbiAgICAvL2xvb3Agb3ZlciBhbGwgaW5wdXRzXHJcbiAgICB0aGlzLl9pbnB1dEVscy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICAvL2Fzc2lnbiBpbnB1dHMgdG8gZW1wdHkgb2JqZWN0IGJ5IG5hbWU9dmFsdWVcclxuICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgY29uc3RydWN0b3IoeyB0aXRsZSwgc3VidGl0bGUgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aXRsZSk7XHJcbiAgICB0aGlzLl9qb2JFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc3VidGl0bGUpO1xyXG4gIH1cclxuICBcclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX25hbWVFbC50ZXh0Q29udGVudCxcclxuICAgICAgYWJvdXQ6IHRoaXMuX2pvYkVsLnRleHRDb250ZW50LFxyXG4gICAgfTtcclxuICB9XHJcbiAgc2V0VXNlckluZm8odmFsdWUpIHtcclxuICAgIFxyXG4gICAgLy9zZXQgdXNlciBpbmZvIGZyb20gdmFsdWVcclxuICAgIHRoaXMuX25hbWVFbC50ZXh0Q29udGVudCA9IHZhbHVlLm5hbWU7XHJcbiAgICB0aGlzLl9qb2JFbC50ZXh0Q29udGVudCA9IHZhbHVlLmFib3V0O1xyXG4gIH1cclxufVxyXG4iLCIvL2J1dCB3aHkgd2UgY2Fubm90IGp1c3QgdXNlIFRBQiBpbmRlbnRhdGlvbiBvbiBjb2RlIGZvcm1hdHRpbmc/IHdoeSBpdCBzaG91bGQgYmUgZG91YmxlIHNwYWNlP1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBEZWxldGUgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBEZWxldGUuanNcIjtcclxuaW1wb3J0IFwiLi4vcGFnZS9pbmRleC5jc3NcIjtcclxuXHJcbmNvbnN0IHByb2ZpbGVBZGRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVfX2FkZC1idXR0b25cIik7XHJcbmNvbnN0IHByb2ZpbGVFZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlX19lZGl0LWJ0blwiKTtcclxuY29uc3QgcHJvZmlsZUF2YXRhckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZV9fYXZhdGFyLWJ0blwiKVxyXG4vL3BsYWNlaG9sZGVyIGZvciBzZWN0aW9uXHJcbmxldCBjYXJkU2VjdGlvbjtcclxuLy9wbGFjZWhvbGRlciBmb3IgdXNlckluZm9cclxubGV0IHVzZXJJbmZvO1xyXG4vL3BsYWNlaG9sZGVyIGZvciB1c2VySWRcclxubGV0IHVzZXJJZDtcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoaXRlbSkge1xyXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gbmV3IENhcmQoXHJcbiAgICBpdGVtLFxyXG4gICAgXCIjY2FyZF9fdGVtcGxhdGVcIixcclxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXHJcbiAgICBoYW5kbGVEZWxldGVDbGljayxcclxuICAgIHVzZXJJZCxcclxuICAgIGhhbmRsZUxpa2VDbGlja1xyXG4gICkuZ2V0VmlldygpO1xyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyQ2FyZChpdGVtKSB7XHJcbiAgY29uc3QgY2FyZCA9IGNyZWF0ZUNhcmQoaXRlbSk7XHJcbiAgY2FyZFNlY3Rpb24uYWRkSXRlbShjYXJkKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljayhuYW1lLCBsaW5rKSB7XHJcbiAgcG9wdXBJbWFnZS5vcGVuKG5hbWUsIGxpbmspO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDbGljayhjYXJkSWQpeyAgXHJcbiAgcG9wdXBEZWxldGUub3BlbigpXHJcbiAgcG9wdXBEZWxldGUuc2V0U3VibWl0QWN0aW9uKCAoKSA9PntcclxuICAgIGFwaS5kZWxldGVDYXJkKGNhcmRJZCkudGhlbiggKCkgPT4geyAgICAgIFxyXG4gICAgICB0aGlzLnJlbW92ZUNhcmQoKVxyXG4gICAgICBwb3B1cERlbGV0ZS5jbG9zZSgpXHJcbiAgICB9KVxyXG4gIH0pICBcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZUNsaWNrKGNhcmRJZCl7ICBcclxuICBpZih0aGlzLmlzTGlrZWQoKSl7XHJcbiAgICBhcGkucmVtb3ZlTGlrZShjYXJkSWQpXHJcbiAgfVxyXG4gIGVsc2V7XHJcbiAgICBhcGkuYWRkTGlrZShjYXJkSWQpXHJcbiAgfVxyXG5cclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcbi8vbmV3IGluc3Qgb2YgQVBJKHNldCBvcHRpb25zKVxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImNkOGIzOTg2LWYzZDYtNGRhOS04ZjQ4LTk2YmM0OGFlNGJiN1wiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG5hcGkuZ2V0VXNlckluZm8oKS50aGVuKChyZXMpID0+IHtcclxuICAvL2Fzc2lnbiBuZXcgdmFsdWUgZm9yIHVzZXJJZFxyXG4gIHVzZXJJZCA9IHJlcy5faWQ7ICBcclxuICAvL25ldyBVc2VySW5mbyBcclxuICB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XHJcbiAgICB0aXRsZTogXCIucHJvZmlsZV9fdGl0bGVcIixcclxuICAgIHN1YnRpdGxlOiBcIi5wcm9maWxlX19zdWJ0aXRsZVwiLFxyXG4gIH0pO1xyXG4gIC8vc2V0dGluZyB1c2VySW5mbyBmcm9tIHNlcnZlclxyXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcylcclxufSlcclxuXHJcbi8vIGxvYWRlZCBjYXJkcyBmcm9tIHNlcnZlclxyXG5hcGkuZ2V0SW5pdGlhbENhcmRzKCkudGhlbigocmVzKSA9PiB7XHJcbiAgLy9uZXcgc2VjdGlvblxyXG4gIGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAgICB7XHJcbiAgICAgIC8vdXNpbmcgZGF0YSBmcm9tIHNlcnZlclxyXG4gICAgICBkYXRhOiByZXMsXHJcbiAgICAgIHJlbmRlcmVyOiAoaXRlbSkgPT4ge1xyXG4gICAgICAgIHJlbmRlckNhcmQoaXRlbSk7XHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgY29uZmlnLmNhcmRTZWN0aW9uQ2xhc3NcclxuICApO1xyXG4gIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKCk7XHJcbn0pO1xyXG5cclxuXHJcbmNvbnN0IHBvcHVwRWRpdEZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNwcm9maWxlX19lZGl0LW1vZGFsXCIsXHJcbiAgKGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyhpbnB1dFZhbHVlcyk7XHJcbiAgICAvL3VwZGF0aW5nIHVzZXJJbmZvIChvbj9hdD9pbikgc2VydmVyXHJcbiAgICBhcGkudXBkYXRlVXNlckluZm8oaW5wdXRWYWx1ZXMpXHJcbiAgICBwb3B1cEVkaXRGb3JtLmNsb3NlKCk7XHJcbiAgfVxyXG4pO1xyXG5cclxuY29uc3QgcG9wdXBBdmF0YXJGcm9tID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjcHJvZmlsZV9fYXZhdGFyX21vZGFsXCIpXHJcblxyXG5jb25zdCBwb3B1cERlbGV0ZSA9IG5ldyBQb3B1cERlbGV0ZShcIiNjYXJkX19kZWxldGUtbW9kYWxcIik7XHJcblxyXG5jb25zdCBwb3B1cEltYWdlID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiI2NhcmRfX2ltYWdlLW1vZGFsXCIpO1xyXG5cclxuY29uc3QgcG9wdXBBZGRGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjcHJvZmlsZV9fYWRkLW1vZGFsXCIsIChpbnB1dFZhbHVlcykgPT4ge1xyXG4gIGFwaS5hZGROZXdDYXJkKGlucHV0VmFsdWVzKS50aGVuKChkYXRhKSA9PiByZW5kZXJDYXJkKGRhdGEpKSAgXHJcbiAgcG9wdXBBZGRGb3JtLmNsb3NlKCk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBmb3JtVmFsaWRhdG9ycyA9IHt9O1xyXG5cclxuLy8gZW5hYmxlIHZhbGlkYXRpb25cclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZywgZm9ybUVsZW1lbnQpO1xyXG4gICAgLy8gaGVyZSB5b3UgZ2V0IHRoZSBuYW1lIG9mIHRoZSBmb3JtXHJcbiAgICBjb25zdCBmb3JtTmFtZSA9IGZvcm1FbGVtZW50LmdldEF0dHJpYnV0ZShcIm5hbWVcIik7XHJcblxyXG4gICAgLy8gaGVyZSB5b3Ugc3RvcmUgYSB2YWxpZGF0b3IgYnkgdGhlIGBuYW1lYCBvZiB0aGUgZm9ybVxyXG4gICAgZm9ybVZhbGlkYXRvcnNbZm9ybU5hbWVdID0gdmFsaWRhdG9yO1xyXG4gICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuICB9KTtcclxufTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oY29uZmlnKTtcclxuXHJcbnBvcHVwSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxucG9wdXBBZGRGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbnBvcHVwRWRpdEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxucG9wdXBEZWxldGUuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxucHJvZmlsZUFkZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gcG9wdXBBZGRGb3JtLm9wZW4oKSk7XHJcbnByb2ZpbGVFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgcG9wdXBFZGl0Rm9ybS5vcGVuKCk7XHJcbiAgcG9wdXBFZGl0Rm9ybS5zZXRJbnB1dFZhbHVlcyh1c2VySW5mby5nZXRVc2VySW5mbygpKTtcclxufSk7XHJcbnByb2ZpbGVBdmF0YXJCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHBvcHVwQXZhdGFyRnJvbS5vcGVuKCkpXHJcblxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9ucyl7XHJcbiAgICAgICAgdGhpcy5fYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcclxuICAgICAgICB0aGlzLl9oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBfY2hlY2tSZXNwb25zZShyZXMpIHtcclxuICAgICAgICBpZiAocmVzLm9rKSB7ICAgICAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIGdldEluaXRpYWxDYXJkcygpe1xyXG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpIFxyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJJbmZvKCl7XHJcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAse1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgdXBkYXRlVXNlckluZm8oaW5wdXQpe1xyXG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBuYW1lOiBpbnB1dC5uYW1lICxcclxuICAgICAgICAgIGFib3V0OiBpbnB1dC5hYm91dFxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgICB9XHJcblxyXG4gICAgYWRkTmV3Q2FyZChpbnB1dCl7XHJcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcclxuICAgICAgICAgIGxpbms6IGlucHV0LmxpbmtcclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQoY2FyZElkKXtcclxuICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAse1xyXG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgICB9XHJcbiAgICBhZGRMaWtlKGNhcmRJZCl7XHJcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLHtcclxuICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxyXG4gICAgfVxyXG4gICAgcmVtb3ZlTGlrZShjYXJkSWQpeyAgICAgIFxyXG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCx7XHJcbiAgICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKSAgICAgIFxyXG4gICAgfVxyXG4gICAgdXBkYXRlUHJvZmlsZVBpY3R1cmUoYXZhdGFyTGluayl7XHJcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLHtcclxuICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGF2YXRhckxpbmspXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vL2h0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXBJZC91c2Vycy9tZS9hdmF0YXJcclxuXHJcblxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBEZWxldGUgZXh0ZW5kcyBQb3B1cHtcclxuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3Ipe1xyXG4gICAgICAgIHN1cGVyKHtwb3B1cFNlbGVjdG9yfSlcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdG4gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idXR0b25cIik7ICAgICAgICBcclxuICAgICAgICAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3VibWl0QWN0aW9uKGhhbmRsZURlbGV0ZSl7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRGVsZXRlID0gaGFuZGxlRGVsZXRlXHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKXtcclxuICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpXHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVEZWxldGUoKTsgICAgICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSAgICBcclxufTsiLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcclxuICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fY2FwdGlvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1jYXB0aW9uXCIpO1xyXG4gIH1cclxuICBvcGVuKG5hbWUsIGxpbmspIHtcclxuICAgIHN1cGVyLm9wZW4oKTsgICAgXHJcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBuYW1lO1xyXG4gICAgdGhpcy5faW1hZ2UuYWx0ID0gbGluaztcclxuICAgIHRoaXMuX2NhcHRpb24udGV4dENvbnRlbnQgPSBsaW5rO1xyXG4gIH1cclxufVxyXG4iLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3Rvcihjb25maWcsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IGNvbmZpZy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gY29uZmlnLmVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5fYnV0dG9uRWwgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvclxyXG4gICAgKTtcclxuICAgIHRoaXMuX2lucHV0RWxzID0gW1xyXG4gICAgICAuLi50aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpLFxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2lucHV0RWxzLmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrVmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlU3VibWl0QnRuKGlucHV0RWwpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5fZGlzYWJsZVN1Ym1pdEJ0bigpO1xyXG4gICAgICAvL3Jlc2V0IFwiZXZlbnRcIlxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIC8vIGBzZXRUaW1lb3V0YCBpcyBuZWVkZWQgdG8gd2FpdCB0aWxsIHRoZSBmb3JtIGlzIGZ1bGx5IHJlc2V0IGFuZCB0aGVuIHRvIGNhbGwgYHRvZ2dsZUJ1dHRvblN0YXRlYFxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5fdG9nZ2xlU3VibWl0QnRuKGlucHV0RWwpO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrVmFsaWRpdHkoaW5wdXRFbCkge1xyXG4gICAgLy90YWtpbmcgaW5wdXRFbCBmcm9tIGV2ZW50IGxpc2VuZXJzXHJcbiAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsKSB7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgIyR7aW5wdXRFbC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvck1lc3NhZ2UudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbCkge1xyXG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWwuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIGVycm9yTWVzc2FnZS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZVN1Ym1pdEJ0bigpIHtcclxuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xyXG4gICAgICB0aGlzLl9kaXNhYmxlU3VibWl0QnRuKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9lbmFibGVTdWJtaXRCdG4oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuX2lucHV0RWxzLmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuICB9XHJcblxyXG4gIF9kaXNhYmxlU3VibWl0QnRuKCkge1xyXG4gICAgdGhpcy5fYnV0dG9uRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIHRoaXMuX2J1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIF9lbmFibGVTdWJtaXRCdG4oKSB7XHJcbiAgICB0aGlzLl9idXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgdGhpcy5fYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yO1xyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsInVzZXJJZCIsImhhbmRsZUxpa2VDbGljayIsInRoaXMiLCJfaWQiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfdXNlcklkIiwiX2NhcmRPd25lcklkIiwib3duZXIiLCJfaGFuZGxlTGlrZUNsaWNrIiwiX2xpa2VBcnIiLCJsaWtlcyIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJfbGlrZUJ0biIsIl9jYXJkIiwiX2RlbGV0ZUJ0biIsIl9pbWFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJfdG9nZ2xlTGlrZUJ0biIsIl9vcGVuSW1hZ2UiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJpc0xpa2VkIiwic29tZSIsIl9yZWYiLCJfcmVuZGVyTGlrZXNDb3VudGVyIiwiX2xpa2VDb3VudGVyIiwidGV4dENvbnRlbnQiLCJsZW5ndGgiLCJyZW1vdmVDYXJkIiwicmVtb3ZlIiwiZ2V0VmlldyIsInNyYyIsImFsdCIsImNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiY2FyZFNlY3Rpb25DbGFzcyIsImNhcmRUZXBsYXRlIiwiU2VjdGlvbiIsImNhcmRMaXN0IiwicmVuZGVyZXIiLCJfcmVuZGVyZWRJdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJyZW5kZXJJdGVtcyIsImZvckVhY2giLCJpdGVtIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwRWxlbWVudCIsIm9wZW4iLCJhZGQiLCJfY2xvc2VCeUVzYyIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfcG9wdXBGb3JtRWwiLCJfaW5wdXRFbHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2hhbmRsZVN1Ym1pdCIsInNldElucHV0VmFsdWVzIiwiaW5wdXQiLCJ2YWx1ZSIsInJlc2V0IiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJVc2VySW5mbyIsInRpdGxlIiwic3VidGl0bGUiLCJfbmFtZUVsIiwiX2pvYkVsIiwiZ2V0VXNlckluZm8iLCJhYm91dCIsInNldFVzZXJJbmZvIiwicHJvZmlsZUFkZEJ0biIsInByb2ZpbGVFZGl0QnRuIiwicHJvZmlsZUF2YXRhckJ0biIsImNhcmRTZWN0aW9uIiwidXNlckluZm8iLCJyZW5kZXJDYXJkIiwiY2FyZCIsImNyZWF0ZUNhcmQiLCJwb3B1cEltYWdlIiwiY2FyZElkIiwicG9wdXBEZWxldGUiLCJzZXRTdWJtaXRBY3Rpb24iLCJhcGkiLCJkZWxldGVDYXJkIiwidGhlbiIsInJlbW92ZUxpa2UiLCJhZGRMaWtlIiwib3B0aW9ucyIsIl9iYXNlVXJsIiwiYmFzZVVybCIsIl9oZWFkZXJzIiwiaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwidXBkYXRlVXNlckluZm8iLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZE5ld0NhcmQiLCJ1cGRhdGVQcm9maWxlUGljdHVyZSIsImF2YXRhckxpbmsiLCJhdXRob3JpemF0aW9uIiwicG9wdXBFZGl0Rm9ybSIsInBvcHVwQXZhdGFyRnJvbSIsIl9zdWJtaXRCdG4iLCJoYW5kbGVEZWxldGUiLCJfaGFuZGxlRGVsZXRlIiwiX2NhcHRpb24iLCJwb3B1cEFkZEZvcm0iLCJmb3JtVmFsaWRhdG9ycyIsIkFycmF5IiwiZnJvbSIsImZvcm1FbGVtZW50IiwidmFsaWRhdG9yIiwiX2lucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsIl9mb3JtRWxlbWVudCIsIl9idXR0b25FbCIsImlucHV0RWwiLCJfY2hlY2tWYWxpZGl0eSIsIl90b2dnbGVTdWJtaXRCdG4iLCJfZGlzYWJsZVN1Ym1pdEJ0biIsInNldFRpbWVvdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiaWQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oYXNJbnZhbGlkSW5wdXQiLCJfZW5hYmxlU3VibWl0QnRuIiwiZXZlcnkiLCJkaXNhYmxlZCIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImZvcm1OYW1lIiwiZ2V0QXR0cmlidXRlIl0sInNvdXJjZVJvb3QiOiIifQ==