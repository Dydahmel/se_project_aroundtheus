!function(){"use strict";class e{constructor(e,t,s,i,n,r){this._id=e._id,this._name=e.name,this._link=e.link,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteClick=i,this._userId=n,this._ownerId=e.owner._id,this._handleLikeClick=r,this._likeId=e.likes}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._likeBtn=this._card.querySelector("#card_like-button"),this._deleteBtn=this._card.querySelector(".card__delete-btn"),this._image=this._card.querySelector(".card__image"),this._likeBtn.addEventListener("click",(()=>{this._toggleLikeBtn(),console.log(this._likeId)})),this._deleteBtn.addEventListener("click",(()=>this._handleDeleteClick(this._id))),this._image.addEventListener("click",(()=>this._openImage()))}_openImage(){this._handleImageClick(this._link,this._name)}_toggleLikeBtn(){this._likeBtn.classList.toggle("card__like-button_enabled"),this._handleLikeClick(this._id)}removeCard(){this._card.remove(),this._card=null}getView(){return this._card=this._getTemplate(),this._setEventListeners(),this._image.src=this._link,this._image.alt=this._name,this._card.querySelector(".card__title").textContent=this._name,this._userId!==this._ownerId&&this._deleteBtn.remove(),this._card}}const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button-disabled",inputErrorClass:".modal__input-type-error",errorClass:"modal__error_visible",cardSectionClass:".cards__list",cardTeplate:".card__teplate"};class s{constructor(e,t){let{data:s,renderer:i}=e;this._renderedItems=s,this._renderer=i,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderItems(){this._renderedItems.forEach((e=>{this._renderer(e)}))}}class i{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._closeByEsc)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._closeByEsc)}_closeByEsc=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{e.target.classList.contains("modal")&&this.close(),e.target.classList.contains("modal__close-button")&&this.close()}))}}class n extends i{constructor(e,s){super({popupSelector:e}),this._popupFormEl=this._popupElement.querySelector(t.formSelector),this._inputEls=this._popupFormEl.querySelectorAll(t.inputSelector),this._handleSubmit=s}setInputValues(e){this._inputEls.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._popupFormEl.reset()}_getInputValues(){const e={};return this._inputEls.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupFormEl.addEventListener("submit",(()=>{this._handleSubmit(this._getInputValues())}))}}class r{constructor(e){let{title:t,subtitle:s}=e;this._nameEl=document.querySelector(t),this._jobEl=document.querySelector(s)}getUserInfo(){return{name:this._nameEl.textContent,about:this._jobEl.textContent}}setUserInfo(e){this._nameEl.textContent=e.name,this._jobEl.textContent=e.about}}const o=document.querySelector("#profile__add-button"),l=document.querySelector("#profile__edit-btn");let a,c,h;function _(t){const s=function(t){return new e(t,"#card__template",d,u,h,m).getView()}(t);a.addItem(s)}function d(e,t){v.open(e,t)}function u(e){b.open(),b.setSubmitAction((()=>{p.deleteCard(e).then((e=>{console.log(e),this.removeCard(),b.close()}))}))}function m(e){this._likeBtn.classList.contains("card__like-button_enabled")?p.addLike(e):p.removeLike(e)}const p=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}updateUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}addNewCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"cd8b3986-f3d6-4da9-8f48-96bc48ae4bb7","Content-Type":"application/json"}});p.getUserInfo().then((e=>{h=e._id,c=new r({title:".profile__title",subtitle:".profile__subtitle"}),c.setUserInfo(e)})),p.getInitialCards().then((e=>{a=new s({data:e,renderer:e=>{_(e)}},t.cardSectionClass),a.renderItems()}));const E=new n("#profile__edit-modal",(e=>{c.setUserInfo(e),p.updateUserInfo(e),E.close()})),b=new class extends i{constructor(e){super({popupSelector:e}),this._submitBtn=this._popupElement.querySelector(".modal__save-button")}setSubmitAction(e){this._handleDelete=e}setEventListeners(){super.setEventListeners(),this._submitBtn.addEventListener("mousedown",(()=>{this._handleDelete()}))}}("#card__delete-modal"),v=new class extends i{constructor(e){super({popupSelector:e}),this._image=this._popupElement.querySelector(".modal__image"),this._caption=this._popupElement.querySelector(".modal__image-caption")}open(e,t){super.open(),this._image.src=e,this._image.alt=t,this._caption.textContent=t}}("#card__image-modal"),S=new n("#profile__add-modal",(e=>{p.addNewCard(e).then((e=>{_(e),console.log(e)})),S.close()})),k={};(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{const s=new class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._buttonEl=this._formElement.querySelector(this._submitButtonSelector),this._inputEls=[...this._formElement.querySelectorAll(this._inputSelector)]}_setEventListeners(){this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._checkValidity(e),this._toggleSubmitBtn(e)})),this._disableSubmitBtn(),this._formElement.addEventListener("reset",(()=>{setTimeout((()=>{this._toggleSubmitBtn(e)}),0)}))}))}_checkValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_toggleSubmitBtn(){this._hasInvalidInput()?this._disableSubmitBtn():this._enableSubmitBtn()}_hasInvalidInput(){return!this._inputEls.every((e=>e.validity.valid))}_disableSubmitBtn(){this._buttonEl.classList.add(this._inactiveButtonClass),this._buttonEl.disabled=!0}_enableSubmitBtn(){this._buttonEl.classList.remove(this._inactiveButtonClass),this._buttonEl.disabled=!1}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}(e,t),i=t.getAttribute("name");k[i]=s,s.enableValidation()}))})(t),v.setEventListeners(),S.setEventListeners(),E.setEventListeners(),b.setEventListeners(),o.addEventListener("click",(()=>S.open())),l.addEventListener("click",(()=>{E.open(),E.setInputValues(c.getUserInfo())})),console.log(h)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cERlbGV0ZS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gIGNvbnN0cnVjdG9yKGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlSW1hZ2VDbGljaywgaGFuZGxlRGVsZXRlQ2xpY2ssIHVzZXJJZCwgaGFuZGxlTGlrZUNsaWNrKSB7XHJcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xyXG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XHJcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrID0gaGFuZGxlRGVsZXRlQ2xpY2s7XHJcbiAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XHJcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7XHJcbiAgICB0aGlzLl9oYW5kbGVMaWtlQ2xpY2sgPSBoYW5kbGVMaWtlQ2xpY2s7XHJcbiAgICB0aGlzLl9saWtlSWQgPSBkYXRhLmxpa2VzO1xyXG4gIH1cclxuXHJcbiAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgY29uc3QgY2FyZEVsID0gZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxyXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcclxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICAgIHJldHVybiBjYXJkRWw7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9saWtlQnRuID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiI2NhcmRfbGlrZS1idXR0b25cIik7XHJcbiAgICB0aGlzLl9kZWxldGVCdG4gPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcclxuICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fbGlrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge3RoaXMuX3RvZ2dsZUxpa2VCdG4oKTsgY29uc29sZS5sb2codGhpcy5fbGlrZUlkKX0pO1xyXG4gICAgdGhpcy5fZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLl9oYW5kbGVEZWxldGVDbGljayh0aGlzLl9pZCkpO1xyXG4gICAgdGhpcy5faW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX29wZW5JbWFnZSgpKTtcclxuICB9XHJcblxyXG4gIF9vcGVuSW1hZ2UoKSB7XHJcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrKHRoaXMuX2xpbmssIHRoaXMuX25hbWUpO1xyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZUxpa2VCdG4oKSB7XHJcbiAgICB0aGlzLl9saWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9lbmFibGVkXCIpO1xyXG4gICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrKHRoaXMuX2lkKTtcclxuICAgIFxyXG4gIH1cclxuXHJcbiAgcmVtb3ZlQ2FyZCgpIHtcclxuICAgIHRoaXMuX2NhcmQucmVtb3ZlKCk7XHJcbiAgICB0aGlzLl9jYXJkID0gbnVsbDtcclxuICB9XHJcblxyXG4gIGdldFZpZXcoKSB7XHJcbiAgICB0aGlzLl9jYXJkID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xyXG4gICAgdGhpcy5faW1hZ2UuYWx0ID0gdGhpcy5fbmFtZTtcclxuICAgIHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XHJcbiAgICAvL2NoZWNrIGlmIHVzZXIgYW5kIG93bmVyIElEIG1hdGNoZXNcclxuICAgIGlmKHRoaXMuX3VzZXJJZCAhPT0gdGhpcy5fb3duZXJJZCl7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUJ0bi5yZW1vdmUoKVxyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmQ7XHJcbiAgfVxyXG59XHJcbiIsIi8vc2VsZWN0b3JzIGZvciB2YWxpZGF0aW9uXHJcblxyXG5jb25zdCBjb25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc2F2ZS1idXR0b25cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zYXZlLWJ1dHRvbi1kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCIubW9kYWxfX2lucHV0LXR5cGUtZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXHJcbiAgY2FyZFNlY3Rpb25DbGFzczogXCIuY2FyZHNfX2xpc3RcIixcclxuICBjYXJkVGVwbGF0ZTogXCIuY2FyZF9fdGVwbGF0ZVwiLFxyXG59O1xyXG5cclxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCIsXHJcbiAgfSxcclxuXTtcclxuXHJcbmV4cG9ydCB7IGNvbmZpZywgaW5pdGlhbENhcmRzIH07XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgZGF0YSwgcmVuZGVyZXIgfSwgY2FyZExpc3QpIHtcclxuICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMgPSBkYXRhO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY2FyZExpc3QpO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5fcmVuZGVyZWRJdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICB9XHJcbiAgb3BlbigpIHtcclxuICAgIC8vb3BlbiBwb3B1cFxyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9jbG9zZUJ5RXNjKTtcclxuICB9XHJcbiAgY2xvc2UoKSB7XHJcbiAgICAvL2Nsb3NlIHBvcHVwXHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2Nsb3NlQnlFc2MpO1xyXG4gIH1cclxuICBfY2xvc2VCeUVzYyA9IChldnQpID0+IHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcclxuICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlLWJ1dHRvblwiKSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cFwiO1xyXG5pbXBvcnQgeyBjb25maWcgfSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZVN1Ym1pdCkge1xyXG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pOyAgICBcclxuICAgIHRoaXMuX3BvcHVwRm9ybUVsID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLmZvcm1TZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9pbnB1dEVscyA9IHRoaXMuX3BvcHVwRm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0OyAgICBcclxuICB9XHJcbiAgc2V0SW5wdXRWYWx1ZXMoZGF0YSkge1xyXG4gICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgLy8gaGVyZSB5b3UgaW5zZXJ0IHRoZSBgdmFsdWVgIGJ5IHRoZSBgbmFtZWAgb2YgdGhlIGlucHV0XHJcbiAgICAgIGlucHV0LnZhbHVlID0gZGF0YVtpbnB1dC5uYW1lXTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtRWwucmVzZXQoKTtcclxuICB9ICBcclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgIC8vZ2V0IGFsbCBpbnB1dHMgICAgXHJcbiAgICAvL2xvb3Agb3ZlciBhbGwgaW5wdXRzXHJcbiAgICB0aGlzLl9pbnB1dEVscy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICAvL2Fzc2lnbiBpbnB1dHMgdG8gZW1wdHkgb2JqZWN0IGJ5IG5hbWU9dmFsdWVcclxuICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgY29uc3RydWN0b3IoeyB0aXRsZSwgc3VidGl0bGUgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aXRsZSk7XHJcbiAgICB0aGlzLl9qb2JFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc3VidGl0bGUpO1xyXG4gIH1cclxuICBcclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX25hbWVFbC50ZXh0Q29udGVudCxcclxuICAgICAgYWJvdXQ6IHRoaXMuX2pvYkVsLnRleHRDb250ZW50LFxyXG4gICAgfTtcclxuICB9XHJcbiAgc2V0VXNlckluZm8odmFsdWUpIHtcclxuICAgIFxyXG4gICAgLy9zZXQgdXNlciBpbmZvIGZyb20gdmFsdWVcclxuICAgIHRoaXMuX25hbWVFbC50ZXh0Q29udGVudCA9IHZhbHVlLm5hbWU7XHJcbiAgICB0aGlzLl9qb2JFbC50ZXh0Q29udGVudCA9IHZhbHVlLmFib3V0O1xyXG4gIH1cclxufVxyXG4iLCIvL2J1dCB3aHkgd2UgY2Fubm90IGp1c3QgdXNlIFRBQiBpbmRlbnRhdGlvbiBvbiBjb2RlIGZvcm1hdHRpbmc/IHdoeSBpdCBzaG91bGQgYmUgZG91YmxlIHNwYWNlP1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBEZWxldGUgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBEZWxldGUuanNcIjtcclxuaW1wb3J0IFwiLi4vcGFnZS9pbmRleC5jc3NcIjtcclxuXHJcbmNvbnN0IHByb2ZpbGVBZGRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVfX2FkZC1idXR0b25cIik7XHJcbmNvbnN0IHByb2ZpbGVFZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlX19lZGl0LWJ0blwiKTtcclxuLy9wbGFjZWhvbGRlciBmb3Igc2VjdGlvblxyXG5sZXQgY2FyZFNlY3Rpb247XHJcbi8vcGxhY2Vob2xkZXIgZm9yIHVzZXJJbmZvXHJcbmxldCB1c2VySW5mbztcclxuLy9wbGFjZWhvbGRlciBmb3IgdXNlcklkXHJcbmxldCB1c2VySWQ7XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGl0ZW0pIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IG5ldyBDYXJkKFxyXG4gICAgaXRlbSxcclxuICAgIFwiI2NhcmRfX3RlbXBsYXRlXCIsXHJcbiAgICBoYW5kbGVJbWFnZUNsaWNrLFxyXG4gICAgaGFuZGxlRGVsZXRlQ2xpY2ssXHJcbiAgICB1c2VySWQsXHJcbiAgICBoYW5kbGVMaWtlQ2xpY2tcclxuICApLmdldFZpZXcoKTtcclxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlckNhcmQoaXRlbSkge1xyXG4gIGNvbnN0IGNhcmQgPSBjcmVhdGVDYXJkKGl0ZW0pO1xyXG4gIGNhcmRTZWN0aW9uLmFkZEl0ZW0oY2FyZCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUltYWdlQ2xpY2sobmFtZSwgbGluaykge1xyXG4gIHBvcHVwSW1hZ2Uub3BlbihuYW1lLCBsaW5rKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2xpY2soY2FyZElkKXsgIFxyXG4gIHBvcHVwRGVsZXRlLm9wZW4oKVxyXG4gIHBvcHVwRGVsZXRlLnNldFN1Ym1pdEFjdGlvbiggKCkgPT57XHJcbiAgICBhcGkuZGVsZXRlQ2FyZChjYXJkSWQpLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZGF0YSlcclxuICAgICAgdGhpcy5yZW1vdmVDYXJkKClcclxuICAgICAgcG9wdXBEZWxldGUuY2xvc2UoKVxyXG4gICAgfSlcclxuICB9KSAgXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUxpa2VDbGljayhjYXJkSWQpeyAgXHJcbiAgaWYodGhpcy5fbGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ1dHRvbl9lbmFibGVkXCIpKXtcclxuICAgIGFwaS5hZGRMaWtlKGNhcmRJZClcclxuICB9XHJcbiAgZWxzZXtcclxuICAgIGFwaS5yZW1vdmVMaWtlKGNhcmRJZClcclxuICB9XHJcblxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuLy9uZXcgaW5zdCBvZiBBUEkoc2V0IG9wdGlvbnMpXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiY2Q4YjM5ODYtZjNkNi00ZGE5LThmNDgtOTZiYzQ4YWU0YmI3XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuXHJcbmFwaS5nZXRVc2VySW5mbygpLnRoZW4oKHJlcykgPT4ge1xyXG4gIC8vYXNzaWduIG5ldyB2YWx1ZSBmb3IgdXNlcklkXHJcbiAgdXNlcklkID0gcmVzLl9pZDsgIFxyXG4gIC8vbmV3IFVzZXJJbmZvIFxyXG4gIHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcclxuICAgIHRpdGxlOiBcIi5wcm9maWxlX190aXRsZVwiLFxyXG4gICAgc3VidGl0bGU6IFwiLnByb2ZpbGVfX3N1YnRpdGxlXCIsXHJcbiAgfSk7XHJcbiAgLy9zZXR0aW5nIHVzZXJJbmZvIGZyb20gc2VydmVyXHJcbiAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKVxyXG59KVxyXG5cclxuLy8gbG9hZGVkIGNhcmRzIGZyb20gc2VydmVyXHJcbmFwaS5nZXRJbml0aWFsQ2FyZHMoKS50aGVuKChyZXMpID0+IHtcclxuICAvL25ldyBzZWN0aW9uXHJcbiAgY2FyZFNlY3Rpb24gPSBuZXcgU2VjdGlvbihcclxuICAgIHtcclxuICAgICAgLy91c2luZyBkYXRhIGZyb20gc2VydmVyXHJcbiAgICAgIGRhdGE6IHJlcyxcclxuICAgICAgcmVuZGVyZXI6IChpdGVtKSA9PiB7XHJcbiAgICAgICAgcmVuZGVyQ2FyZChpdGVtKTtcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBjb25maWcuY2FyZFNlY3Rpb25DbGFzc1xyXG4gICk7XHJcbiAgY2FyZFNlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxufSk7XHJcblxyXG5cclxuY29uc3QgcG9wdXBFZGl0Rm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFxyXG4gIFwiI3Byb2ZpbGVfX2VkaXQtbW9kYWxcIixcclxuICAoaW5wdXRWYWx1ZXMpID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKGlucHV0VmFsdWVzKTtcclxuICAgIC8vdXBkYXRpbmcgdXNlckluZm8gKG9uP2F0P2luKSBzZXJ2ZXJcclxuICAgIGFwaS51cGRhdGVVc2VySW5mbyhpbnB1dFZhbHVlcylcclxuICAgIHBvcHVwRWRpdEZvcm0uY2xvc2UoKTtcclxuICB9XHJcbik7XHJcblxyXG5cclxuXHJcbmNvbnN0IHBvcHVwRGVsZXRlID0gbmV3IFBvcHVwRGVsZXRlKFwiI2NhcmRfX2RlbGV0ZS1tb2RhbFwiKTtcclxuXHJcbmNvbnN0IHBvcHVwSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjY2FyZF9faW1hZ2UtbW9kYWxcIik7XHJcblxyXG5jb25zdCBwb3B1cEFkZEZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNwcm9maWxlX19hZGQtbW9kYWxcIiwgKGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgYXBpLmFkZE5ld0NhcmQoaW5wdXRWYWx1ZXMpLnRoZW4oKGRhdGEpID0+IHtyZW5kZXJDYXJkKGRhdGEpOyBjb25zb2xlLmxvZyhkYXRhKX0pICBcclxuICBwb3B1cEFkZEZvcm0uY2xvc2UoKTtcclxufSk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0ge307XHJcblxyXG4vLyBlbmFibGUgdmFsaWRhdGlvblxyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgdmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uZmlnLCBmb3JtRWxlbWVudCk7XHJcbiAgICAvLyBoZXJlIHlvdSBnZXQgdGhlIG5hbWUgb2YgdGhlIGZvcm1cclxuICAgIGNvbnN0IGZvcm1OYW1lID0gZm9ybUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcclxuXHJcbiAgICAvLyBoZXJlIHlvdSBzdG9yZSBhIHZhbGlkYXRvciBieSB0aGUgYG5hbWVgIG9mIHRoZSBmb3JtXHJcbiAgICBmb3JtVmFsaWRhdG9yc1tmb3JtTmFtZV0gPSB2YWxpZGF0b3I7XHJcbiAgICB2YWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuZW5hYmxlVmFsaWRhdGlvbihjb25maWcpO1xyXG5cclxucG9wdXBJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5wb3B1cEFkZEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxucG9wdXBFZGl0Rm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5wb3B1cERlbGV0ZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5wcm9maWxlQWRkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBwb3B1cEFkZEZvcm0ub3BlbigpKTtcclxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBwb3B1cEVkaXRGb3JtLm9wZW4oKTtcclxuICBwb3B1cEVkaXRGb3JtLnNldElucHV0VmFsdWVzKHVzZXJJbmZvLmdldFVzZXJJbmZvKCkpO1xyXG59KTtcclxuXHJcblxyXG5jb25zb2xlLmxvZyh1c2VySWQpIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpe1xyXG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBvcHRpb25zLmJhc2VVcmw7XHJcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycztcclxuXHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XHJcbiAgICAgICAgaWYgKHJlcy5vaykgeyAgICAgICAgICBcclxuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9XHJcbiAgICBcclxuXHJcbiAgICBnZXRJbml0aWFsQ2FyZHMoKXtcclxuICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCx7XHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKSBcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VySW5mbygpe1xyXG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHVwZGF0ZVVzZXJJbmZvKGlucHV0KXtcclxuICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSAsXHJcbiAgICAgICAgICBhYm91dDogaW5wdXQuYWJvdXRcclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxyXG4gICAgfVxyXG5cclxuICAgIGFkZE5ld0NhcmQoaW5wdXQpe1xyXG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgIG5hbWU6IGlucHV0Lm5hbWUsXHJcbiAgICAgICAgICBsaW5rOiBpbnB1dC5saW5rXHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVDYXJkKGNhcmRJZCl7XHJcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLHtcclxuICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxyXG4gICAgfVxyXG4gICAgYWRkTGlrZShjYXJkSWQpe1xyXG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCx7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBVVFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgIH1cclxuICAgIHJlbW92ZUxpa2UoY2FyZElkKXsgICAgICBcclxuICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAse1xyXG4gICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xyXG4gICAgICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSkgICAgICBcclxuICAgIH1cclxufVxyXG5cclxuXHJcblxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBEZWxldGUgZXh0ZW5kcyBQb3B1cHtcclxuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3Ipe1xyXG4gICAgICAgIHN1cGVyKHtwb3B1cFNlbGVjdG9yfSlcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdG4gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idXR0b25cIik7ICAgICAgICBcclxuICAgICAgICAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3VibWl0QWN0aW9uKGhhbmRsZURlbGV0ZSl7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRGVsZXRlID0gaGFuZGxlRGVsZXRlXHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKXtcclxuICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpXHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVEZWxldGUoKTsgICAgICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSAgICBcclxufTsiLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcclxuICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fY2FwdGlvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1jYXB0aW9uXCIpO1xyXG4gIH1cclxuICBvcGVuKG5hbWUsIGxpbmspIHtcclxuICAgIHN1cGVyLm9wZW4oKTsgICAgXHJcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBuYW1lO1xyXG4gICAgdGhpcy5faW1hZ2UuYWx0ID0gbGluaztcclxuICAgIHRoaXMuX2NhcHRpb24udGV4dENvbnRlbnQgPSBsaW5rO1xyXG4gIH1cclxufVxyXG4iLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3Rvcihjb25maWcsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IGNvbmZpZy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gY29uZmlnLmVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5fYnV0dG9uRWwgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvclxyXG4gICAgKTtcclxuICAgIHRoaXMuX2lucHV0RWxzID0gW1xyXG4gICAgICAuLi50aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpLFxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2lucHV0RWxzLmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrVmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlU3VibWl0QnRuKGlucHV0RWwpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5fZGlzYWJsZVN1Ym1pdEJ0bigpO1xyXG4gICAgICAvL3Jlc2V0IFwiZXZlbnRcIlxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIC8vIGBzZXRUaW1lb3V0YCBpcyBuZWVkZWQgdG8gd2FpdCB0aWxsIHRoZSBmb3JtIGlzIGZ1bGx5IHJlc2V0IGFuZCB0aGVuIHRvIGNhbGwgYHRvZ2dsZUJ1dHRvblN0YXRlYFxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5fdG9nZ2xlU3VibWl0QnRuKGlucHV0RWwpO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrVmFsaWRpdHkoaW5wdXRFbCkge1xyXG4gICAgLy90YWtpbmcgaW5wdXRFbCBmcm9tIGV2ZW50IGxpc2VuZXJzXHJcbiAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsKSB7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgIyR7aW5wdXRFbC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvck1lc3NhZ2UudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbCkge1xyXG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWwuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIGVycm9yTWVzc2FnZS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZVN1Ym1pdEJ0bigpIHtcclxuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xyXG4gICAgICB0aGlzLl9kaXNhYmxlU3VibWl0QnRuKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9lbmFibGVTdWJtaXRCdG4oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuX2lucHV0RWxzLmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuICB9XHJcblxyXG4gIF9kaXNhYmxlU3VibWl0QnRuKCkge1xyXG4gICAgdGhpcy5fYnV0dG9uRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIHRoaXMuX2J1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIF9lbmFibGVTdWJtaXRCdG4oKSB7XHJcbiAgICB0aGlzLl9idXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgdGhpcy5fYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yO1xyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsInVzZXJJZCIsImhhbmRsZUxpa2VDbGljayIsInRoaXMiLCJfaWQiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfdXNlcklkIiwiX293bmVySWQiLCJvd25lciIsIl9oYW5kbGVMaWtlQ2xpY2siLCJfbGlrZUlkIiwibGlrZXMiLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX2xpa2VCdG4iLCJfY2FyZCIsIl9kZWxldGVCdG4iLCJfaW1hZ2UiLCJhZGRFdmVudExpc3RlbmVyIiwiX3RvZ2dsZUxpa2VCdG4iLCJjb25zb2xlIiwibG9nIiwiX29wZW5JbWFnZSIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInJlbW92ZUNhcmQiLCJyZW1vdmUiLCJnZXRWaWV3Iiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJjb25maWciLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImNhcmRTZWN0aW9uQ2xhc3MiLCJjYXJkVGVwbGF0ZSIsIlNlY3Rpb24iLCJfcmVmIiwiY2FyZExpc3QiLCJyZW5kZXJlciIsIl9yZW5kZXJlZEl0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsInJlbmRlckl0ZW1zIiwiZm9yRWFjaCIsIml0ZW0iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXBFbGVtZW50Iiwib3BlbiIsImFkZCIsIl9jbG9zZUJ5RXNjIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZ0Iiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVTdWJtaXQiLCJzdXBlciIsIl9wb3B1cEZvcm1FbCIsIl9pbnB1dEVscyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfaGFuZGxlU3VibWl0Iiwic2V0SW5wdXRWYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwicmVzZXQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dFZhbHVlcyIsIlVzZXJJbmZvIiwidGl0bGUiLCJzdWJ0aXRsZSIsIl9uYW1lRWwiLCJfam9iRWwiLCJnZXRVc2VySW5mbyIsImFib3V0Iiwic2V0VXNlckluZm8iLCJwcm9maWxlQWRkQnRuIiwicHJvZmlsZUVkaXRCdG4iLCJjYXJkU2VjdGlvbiIsInVzZXJJbmZvIiwicmVuZGVyQ2FyZCIsImNhcmQiLCJjcmVhdGVDYXJkIiwicG9wdXBJbWFnZSIsImNhcmRJZCIsInBvcHVwRGVsZXRlIiwic2V0U3VibWl0QWN0aW9uIiwiYXBpIiwiZGVsZXRlQ2FyZCIsInRoZW4iLCJhZGRMaWtlIiwicmVtb3ZlTGlrZSIsIm9wdGlvbnMiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImhlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsInVwZGF0ZVVzZXJJbmZvIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhZGROZXdDYXJkIiwiYXV0aG9yaXphdGlvbiIsInBvcHVwRWRpdEZvcm0iLCJfc3VibWl0QnRuIiwiaGFuZGxlRGVsZXRlIiwiX2hhbmRsZURlbGV0ZSIsIl9jYXB0aW9uIiwicG9wdXBBZGRGb3JtIiwiZm9ybVZhbGlkYXRvcnMiLCJBcnJheSIsImZyb20iLCJmb3JtRWxlbWVudCIsInZhbGlkYXRvciIsIl9pbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJfZm9ybUVsZW1lbnQiLCJfYnV0dG9uRWwiLCJpbnB1dEVsIiwiX2NoZWNrVmFsaWRpdHkiLCJfdG9nZ2xlU3VibWl0QnRuIiwiX2Rpc2FibGVTdWJtaXRCdG4iLCJzZXRUaW1lb3V0IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oaWRlSW5wdXRFcnJvciIsIl9zaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsImlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGFzSW52YWxpZElucHV0IiwiX2VuYWJsZVN1Ym1pdEJ0biIsImV2ZXJ5IiwiZGlzYWJsZWQiLCJlbmFibGVWYWxpZGF0aW9uIiwicHJldmVudERlZmF1bHQiLCJmb3JtTmFtZSIsImdldEF0dHJpYnV0ZSJdLCJzb3VyY2VSb290IjoiIn0=